<!doctype html><html lang="zh-hant-tw">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Koch Curve In Action</title>

	<style>
		body {
			font-family: "Arial";
			text-align: center;
		}

		#result {
			font-family: "Consolas";
		}

		#func {
			width: 80px;
		}

		#func:hover {
			color: white;
			background-color: steelblue;
		}

	</style>

	<script>
		function kochColor() {
			return `rgb(${200 - count % 200}, 100, 100)`;
		}

		function kochCurve(px, py, size, order) {

			function curve(x0, y0, size, order, angle) {
				cxt.save();
				cxt.translate(x0, y0);
				cxt.rotate(angle);

				if (order == 0) {
					cxt.moveTo(0, 0);
					cxt.lineTo(size, 0);
				}
				else {
					curve(0, 0,
						size / 3, order - 1, 0);
					curve(size / 3 , 0,
						size / 3, order - 1, -(Math.PI / 3));
					curve(size / 2 , -((size / 3) * Math.sin(Math.PI / 3)),
						size / 3, order - 1, Math.PI / 3);
					curve(2 * (size / 3), 0,
						size / 3, order - 1, 0);
				}

				cxt.restore();
			}

			curve(px, py, size, order, 0);
		}

		function kochDraw(x0, y0, size, order, angle) {
			cxt.save();
			cxt.translate(x0, y0);
			cxt.rotate(angle);
			cxt.beginPath();

			const x1 = -(size / 2);
			const y1 = -((size / 3) * Math.sin(Math.PI / 3));

			kochCurve(x1, y1, size, order);
			cxt.rotate(2 * (Math.PI / 3));
			kochCurve(x1, y1, size, order);
			cxt.rotate(2 * (Math.PI / 3));
			kochCurve(x1, y1, size, order);

			cxt.strokeStyle = kochColor();
			cxt.stroke();
			cxt.restore();
		}

		function drawIt() {
			const min = 15;  // range of snowflake's size [min, max]
			const max = 55;
			const orderMax = 3;  // maximum order for resolution's sake

			count = count + 1;  // keep trying
			if (count % 100 == 0) notify();

			const x = Math.floor(Math.random() * canvas.width);
			const y = Math.floor(Math.random() * canvas.height);
			const s = Math.floor(Math.random() * (max - min + 1)) + min;
			const n = Math.floor(Math.random() * (orderMax + 1));

			if ((n == 0 && s > min + 5) ||
				(n == 1 && s > min + 20) ||
				(n == 2 && s < max - 20) ||
				(n == 3 && s < max - 5))
				return;

			for (const one of snowflakes) {
				const a = one[0] - x;
				const b = one[1] - y;
				if (Math.sqrt(a * a + b * b) < (one[2] + s) / Math.sqrt(3))
					return;
			}

			snowflakes.push([x, y, s]);
			kochDraw(x, y, s, n, (Math.random() - 0.5) * Math.PI);
		}
	</script>
</head>

<body>
   	<h3>Snowflake, snowflake everywhere, ... counting endlessly</h3>

	<canvas id="koch" width="800" height="600"
		style="border: 1px solid lightgray; border-radius: 2px;">
		This canvas could be as large as your imagination.
	</canvas>

	<div id="result">You're getting snowflakes.</div>
	<button id="func">Click Me</button>

	<script>
		// necessary initializations
		const snowflakes = new Array();
		const result = document.getElementById("result");
		const canvas = document.getElementById("koch");
		const cxt = canvas.getContext("2d");
		let count = 0;

		cxt.lineWidth = 1;

		function notify() {
			result.innerHTML = "Attempt count: " + String(count) +
			", Number of drawn snowflakes: " +
			String(snowflakes.length);
		}

		// get it started
		drawIt();

		let myInterval = setInterval(drawIt, 100);
		let myState = false;
		const myButton = document.getElementById("func");

		myButton.addEventListener("click", () => {
			if (myState) {
				myInterval = setInterval(drawIt, 100);
				myButton.innerHTML = "Pause";
			}
			else {
				clearInterval(myInterval);
				myButton.innerHTML = "Run";
				notify();
			}
			myState = !myState;
		}, true);
	</script>
</body></html>
