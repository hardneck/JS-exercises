<!doctype html><html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Counting Snowflakes</title>

	<style>
		body {
			font-family: "Arial";
			text-align: center;
		}

		#result {
			font-family: "Consolas";
			font-style: italic;
		}
	</style>

	<script>
		function kochColor() {
			return `rgb(${200 - count % 200}, 100, 100)`;
		}

		function kochCurve(px, py, size, order) {

			function curve(x0, y0, size, order, angle) {
				cxt.save();
				cxt.translate(x0, y0);
				cxt.rotate(angle);

				if (order == 0) {
					// cxt.moveTo(0, 0);
					cxt.lineTo(size, 0);
				}
				else {
					curve(0, 0,
						size / 3, order - 1, 0);
					curve(size / 3 , 0,
						size / 3, order - 1, -(Math.PI / 3));
					curve(size / 2 , -((size / 3) * Math.sin(Math.PI / 3)),
						size / 3, order - 1, Math.PI / 3);
					curve(2 * (size / 3), 0,
						size / 3, order - 1, 0);
				}

				cxt.restore();
			}

			curve(px, py, size, order, 0);
		}

		function kochDraw(x0, y0, size, order, angle) {
			cxt.save();
			cxt.translate(x0, y0);
			cxt.rotate(angle);
			cxt.beginPath();

			const x1 = -(size / 2);
			const y1 = -((size / 3) * Math.sin(Math.PI / 3));

			// get ready at the starting point
			cxt.moveTo(x1, y1);

			kochCurve(x1, y1, size, order);
			cxt.rotate(2 * (Math.PI / 3));
			kochCurve(x1, y1, size, order);
			cxt.rotate(2 * (Math.PI / 3));
			kochCurve(x1, y1, size, order);

			cxt.strokeStyle = kochColor();
			cxt.stroke();
			cxt.restore();

			cxt.font = "8px monospace";
			cxt.textAlign = "center";
			cxt.textBaseline = "middle";
			cxt.fillText(`${snowflakes.length}`, x0, y0);
		}

		function drawIt() {
			const min = 15;  // range of a snowflake's size [min, max]
			const max = 55;
			const orderMax = 3;  // maximum order for resolution's sake

			count = count + 1;  // keep trying

			const x = Math.floor(Math.random() * canvas.width);
			const y = Math.floor(Math.random() * canvas.height);
			const s = Math.floor(Math.random() * (max - min + 1)) + min;
			const n = Math.floor(Math.random() * (orderMax + 1));

			if ((n == 0 && s > min + 5) ||
				(n == 1 && s > min + 20) ||
				(n == 2 && s < max - 20) ||
				(n == 3 && s < max - 5))
				return;

			for (const one of snowflakes) {
				const a = one[0] - x;
				const b = one[1] - y;
				if (Math.sqrt(a * a + b * b) < (one[2] + s) / Math.sqrt(3))
					return;
			}

			snowflakes.push([x, y, s]);
			kochDraw(x, y, s, n, (Math.random() - 0.5) * Math.PI);

			if (snowflakes.length == 100) {
				clearInterval(interval);
				result.innerHTML = "Attempt count: " + String(count) +
					"&nbsp;&nbsp;&nbsp;" + "Number of drawn snowflakes: " +
					String(snowflakes.length);
			}
		}
	</script>
</head>

<body>
   	<h3>Snowflakes, snowflakes everywhere, ... counting to 100</h3>

	<canvas id="koch" width="800" height="600"
		style="border: 1px solid lightgray; border-radius: 2px;">
		This canvas could be as large as your imagination.
	</canvas>

	<p id="result">You're getting snowflakes.</p>

	<script>
		// necessary initializations
		const snowflakes = new Array();
		const result = document.getElementById("result");
		const canvas = document.getElementById("koch");
		const cxt = canvas.getContext("2d");

		// record how many attempts are made
		let count = 0;

		cxt.lineWidth = 1;

		// start once and at timed intervals
		drawIt();
		const interval = setInterval(drawIt, 100);
	</script>
</body></html>
